const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-uQ9GgSHU.js","assets/index-CTqjZuN2.css"])))=>i.map(i=>d[i]);
import{d as ce,e as B,_ as de,a as I,j as e,L as M,m as v,f as w,h as me,i as T,k as U,T as L,r as f,B as j,I as pe,t as u,l as ue,n as xe,o as ge,p as he,q as ye,s as fe,U as be,v as je,w as H,C as ve,x as we,y as Ne,S as ke,z as Ce,D as Se,E as Ae,F as Ie,G as Pe,A as X,H as Ee,J as Ue}from"./index-uQ9GgSHU.js";import{categoriesApi as Me}from"./index-B9ALZQ7I.js";import{u as Ge,A as Le}from"./useAdEvents-C2sV8TmA.js";const Te=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],De=ce("link-2",Te),Oe=t=>B({queryKey:["ad-categories",t],queryFn:()=>Me.getCategories(t)}),Ve=(t,n)=>B({queryKey:["category-templates",t,n],queryFn:async()=>{if(!t)throw new Error("Category ID is required");const{templateApi:i}=await de(async()=>{const{templateApi:p}=await import("./index-uQ9GgSHU.js").then(a=>a.aq);return{templateApi:p}},__vite__mapDeps([0,1])),x=t.includes(",")?t.split(","):[t];return i.getTemplates({categoryIds:x,mediaType:n,page:1,limit:50})},enabled:!!t});function _e(){const{selectedCategoryId:t,setSelectedCategory:n,goToNextStep:i,options:x}=I(),{data:p,isLoading:a}=Oe({limit:50,withTemplatesOnly:!0}),d=p?.data||[],m=new Map;d.forEach(r=>{const c=m.get(r.name);c?(c.templateCount=(c.templateCount||0)+(r.templateCount||0),c.mergedIds||(c.mergedIds=[c.id]),c.mergedIds.push(r.id)):m.set(r.name,{...r,mergedIds:[r.id]})});const l=Array.from(m.values());console.log("Categories for mediaType:",x.mediaType,l);const o=r=>{n(r.join(",")),i()};if(a)return e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(M,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm font-black uppercase tracking-widest text-gray-400",children:"Scanning Categories..."})]})});const g={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},h={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-3xl font-black text-gray-900 uppercase tracking-tighter",children:["Choose Ad ",e.jsx("span",{className:"text-primary",children:"Type"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-2 font-medium max-w-md mx-auto",children:"Select a category to unlock specialized AI templates optimized for your target audience."})]}),e.jsx(v.div,{variants:g,initial:"hidden",animate:"visible",className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:l.map(r=>{const c=t===r.id;return e.jsx(v.button,{variants:h,onClick:()=>o(r.mergedIds),className:w("group relative p-4 rounded-xl border-2 transition-all duration-300","hover:shadow-xl hover:-translate-y-1",c?"border-primary bg-white shadow-2xl shadow-primary/20 ring-4 ring-primary/10":"border-gray-100 bg-white hover:border-primary/30"),children:e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:w("font-black text-xs uppercase tracking-tight mb-1",c?"text-primary":"text-gray-900"),children:r.name}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[r.templateCount!==void 0&&e.jsxs(me,{variant:c?"default":"secondary",className:w("text-[9px] px-2 py-0 h-4 rounded-full font-black",!c&&"bg-gray-100 text-gray-500 border-none"),children:[r.templateCount," ",r.templateCount===1?"TMPL":"TMPLS"]}),c&&e.jsx(v.div,{initial:{scale:0},animate:{scale:1},className:"h-4 w-4 rounded-full bg-primary flex items-center justify-center",children:e.jsx(T,{className:"h-2.5 w-2.5 text-white"})})]})]})},r.id)})})]})}function Re({customPrompt:t,setCustomPrompt:n,style:i,setStyle:x,mood:p,setMood:a,variations:d,setVariations:m}){return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-md p-8 shadow-sm space-y-8",children:[e.jsx("h2",{className:"text-lg font-black text-gray-900 uppercase tracking-tighter",children:"Generation Settings"}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx(U,{className:"text-[11px] font-black uppercase tracking-widest text-gray-500 mb-3 block",children:"Campaign Message (Optional)"}),e.jsx(L,{value:t,onChange:l=>n(l.target.value),placeholder:"Describe the atmosphere and key product features...",className:"min-h-[120px] rounded-md border-gray-100 bg-gray-50/50 focus:border-primary transition-colors resize-none"})]})})]})}function Fe({scenes:t=[],setScenes:n,duration:i,setDuration:x,videoScript:p,setVideoScript:a}){const d=i==="5"?1:i==="10"?2:3,m=(l,o)=>{const g=[...t];for(;g.length<d;)g.push("");g[l]=o,n?.(g)};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-md p-8 shadow-sm space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{className:"text-[11px] font-black uppercase tracking-widest text-primary mb-3 block",children:"Video Script (Voiceover/Text)"}),e.jsx(L,{value:p?.content||"",onChange:l=>a?.({type:p?.type||"TEXT",content:l.target.value}),placeholder:"Enter the text for AI voiceover or on-screen text...",className:"min-h-[100px] rounded-md border-gray-100 bg-blue-50/30 focus:border-primary transition-colors resize-none text-sm",maxLength:500}),e.jsxs("p",{className:"text-[10px] text-gray-400 font-medium",children:[p?.content?.length||0," / 500 characters"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(U,{className:"text-[11px] font-black uppercase tracking-widest text-gray-500 mb-3 block",children:"Video Duration"}),e.jsx("div",{className:"flex gap-2",children:[5,10,15].map(l=>e.jsxs("button",{onClick:()=>x?.(l.toString()),className:w("px-4 py-2 rounded-md text-[10px] font-black uppercase tracking-widest border transition-all",i===l.toString()?"bg-primary border-primary text-white shadow-lg shadow-primary/20":"bg-white border-gray-100 text-gray-500 hover:border-primary/50"),children:[l," Seconds"]},l))})]}),e.jsx("div",{className:"space-y-6",children:[...Array(d)].map((l,o)=>e.jsxs("div",{children:[e.jsxs(U,{className:"text-[11px] font-black uppercase tracking-widest text-gray-500 mb-3 block",children:["Scene ",o+1," ",o===0?"(Required)":"(Optional)"]}),e.jsx(L,{value:t[o]||"",onChange:g=>m(o,g.target.value),placeholder:`Describe scene ${o+1}...`,className:"min-h-[80px] rounded-md border-gray-100 bg-gray-50/50 focus:border-primary transition-colors resize-none"})]},o))})]})]})}function ze({modelImageUrl:t,onImageChange:n,onFileChange:i,isUploading:x=!1}){const[p,a]=f.useState(!1),[d,m]=f.useState(""),l=()=>{if(!d.trim()){u.error("Please enter a valid URL");return}n(d.trim()),a(!1),m("")},o=()=>{n(null),i(null)};return e.jsxs("section",{className:"bg-white rounded-2xl border border-gray-100 p-8 shadow-2xl shadow-gray-200/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-purple-500/10 flex items-center justify-center text-purple-500",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx("h3",{className:"text-xl font-black text-gray-900 uppercase tracking-tighter",children:"Character Reference"})]}),!t&&e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>a(!p),className:w("h-9 px-4 rounded-full font-black uppercase tracking-widest text-[10px] transition-all",p?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400 hover:text-blue-500"),children:[e.jsx(De,{className:"h-3 w-3 mr-2"}),p?"Cancel Link":"Link"]})]}),e.jsx("p",{className:"text-xs text-gray-400 mb-6 font-medium",children:"Upload a character reference or provide a link to anchor the AI's generation around a specific human persona."}),p&&!t&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50/50 border border-blue-100 rounded-xl mb-6 animate-in fade-in slide-in-from-top-2",children:[e.jsx(pe,{value:d,onChange:g=>m(g.target.value),placeholder:"Paste image URL here...",className:"flex-1 h-10 border-none bg-transparent focus-visible:ring-0 text-sm font-medium"}),e.jsx(j,{size:"sm",onClick:l,className:"h-8 w-8 p-0 rounded-lg bg-blue-500 hover:bg-blue-600 shadow-lg shadow-blue-200",children:e.jsx(T,{className:"h-4 w-4 text-white"})})]}),e.jsx("div",{className:"space-y-4",children:t?e.jsxs("div",{className:"relative group rounded-2xl overflow-hidden aspect-video border-2 border-gray-100 bg-gray-50",children:[e.jsx("img",{src:t,alt:"Model Reference",className:"w-full h-full object-contain",onError:()=>{u.error("Failed to load reference image"),o()}}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3",children:e.jsxs(j,{variant:"destructive",size:"sm",onClick:o,className:"font-black uppercase tracking-widest text-[10px] rounded-full px-6",children:[e.jsx(ue,{className:"h-3 w-3 mr-2"}),"Remove Reference"]})})]}):e.jsx(xe,{label:"Upload Persona",description:"Drag & drop or click to upload a human reference",onImageChange:i,isLoading:x,className:"aspect-video"})})]})}function We(){const{selectedProducts:t,selectedTemplate:n,uploadedImageUrl:i,prompt:x,variableValues:p,options:a,generatedAd:d,generationStatus:m,toggleProduct:l,setUploadedImageUrl:o,setPrompt:g,setOptions:h,setGeneratedAd:r,setGenerationStatus:c,setVideoScript:P,goToPreviousStep:K}=I(),E=ge(),{mutateAsync:Q}=he(),[J,D]=f.useState(!1),[Y,O]=f.useState(!1),V=ye(),{user:N}=fe(),Z=N?.role.toLowerCase()===be.GUEST.toLowerCase(),{data:_}=je(),k=a.mediaType==="IMAGE"?1:5,C=!!_&&_.status==="ACTIVE",ee=N?.creditWallet?.balance!==void 0?N.creditWallet.balance>=k:!0,R=C&&ee,F=10,z=2;Ge(d?.data?.id||null);const G=m==="PENDING"||m==="PROCESSING"||E.isPending;f.useEffect(()=>{m==="COMPLETED"&&d?.data?.id&&V({to:`/ads/preview/${d.data.id}`})},[m,d?.data?.id,V]);const te=f.useMemo(()=>t.map(s=>s.id.startsWith("temp_")?{id:s.id,title:s.metadata?.title||"Ingested Asset",description:s.metadata?.description,imageUrl:s.metadata?.imageUrl,productSource:"UPLOADED"}:{id:s.id,title:s.metadata?.title||"Product Asset",description:s.metadata?.description,images:s.metadata?.imageUrl?[{url:s.metadata.imageUrl}]:[],imageUrl:s.metadata?.imageUrl,productSource:s.source}),[t]),ae=(s,b,S)=>{console.log("Product selected:",s,b,S),s&&l(s,b?"UPLOADED":"STORE",S)},se=async()=>{if(!a.mediaType){u.error("Generation configuration error. Please try refreshing the page.");return}if(t.length===0&&!i){u.error("Please select or upload a product");return}if(t.length===0){u.error("Please select a product");return}if(t.length<2){u.error("Please select at least 2 products to generate an ad.");return}if(Z&&a.mediaType==="VIDEO"){if(a.duration&&a.duration>F){u.error(`Guest accounts are limited to ${F}s video duration. Please reduce the duration.`);return}if(a.scenes&&a.scenes.length>z){u.error(`Guest accounts are limited to ${z} scenes per video ad.`);return}}c("PENDING"),u.loading("Queuing ad generation...",{id:"gen-toast"});try{const b=(await Promise.all(t.map(async y=>{if(y.id?.startsWith("temp_")||y.isManual){const le=y.metadata?.imageUrl||y.url,q=y.metadata?.imageUrl||le;if(!q)return null;const $=await Pe.createUploadedProduct({title:y.metadata?.title||"Uploaded Product",images:[{url:q,position:0}],isActive:!0});return $?.data?.id?{productId:$.data.id,source:"UPLOADED"}:null}else return{productId:y.id,source:y.source||"UPLOADED"}}))).filter(y=>y!==null);if(b.length===0){u.error("Could not resolve product(s). Please try again.",{id:"gen-toast"}),c("FAILED");return}const S={products:b,templateId:n?.id||void 0,variableValues:p,aspectRatio:a.dimensions,variantsCount:a.variants,color:void 0},ne={...S,mediaType:"IMAGE",prompt:x||void 0},oe={...S,mediaType:"VIDEO",scenes:a.scenes,duration:a?.duration||void 0,modelImageUrl:a.modelImageUrl||void 0,videoScript:a.videoScript?.content?.trim()?a.videoScript:void 0},W=a.mediaType==="IMAGE"?ne:oe;console.log("[Ad Generation Payload]:",W);const A=await E.mutateAsync(W);r({data:{id:A.data.id,title:A.data.title||"Generated Ad",mediaType:A.data.mediaType||a.mediaType,status:A.data.status||"PENDING",createdAt:A.data.createdAt}}),u.success("Ad generation started",{id:"gen-toast"})}catch(s){console.error("Failed to generate ad:",s),c("FAILED"),u.error("Generation failed. Please try again.",{id:"gen-toast"})}},re=async()=>{if(c("CANCELLED"),u.info("Generation stopping...",{id:"gen-toast"}),d?.data?.id)try{await Ie.cancelAd(d.data.id),u.success("Generation cancelled",{id:"gen-toast"})}catch(s){console.error("Failed to cancel ad:",s),u.error("Generation stopped (Sync issues may occur)",{id:"gen-toast"})}else u.success("Generation aborted",{id:"gen-toast"})},ie=async s=>{if(s){D(!0);try{const b=await Q({file:s});h({modelImageUrl:b.data.url}),u.success("Reference persona uploaded")}catch{u.error("Upload failed")}finally{D(!1)}}else h({modelImageUrl:null})};return G?e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(Le,{status:m,onCancel:re})}):e.jsxs("div",{className:"space-y-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-4xl font-black text-gray-900 uppercase tracking-tighter",children:["Customize ",e.jsx("span",{className:"text-primary",children:"Ad"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-2 font-medium max-w-sm",children:"Finalize asset composition and calibrate AI parameters for optimal creative output."})]}),e.jsxs(j,{variant:"ghost",onClick:K,className:"px-8 h-12 bg-gray-100 rounded-full font-black uppercase tracking-widest text-[10px] text-gray-400 hover:text-primary transition-colors",children:[e.jsx(H,{className:"mr-2 h-3 w-3"}),"Change Template"]})]}),m==="FAILED"&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3 animate-in fade-in slide-in-from-top-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-red-100 flex items-center justify-center shrink-0",children:e.jsx(ve,{className:"h-5 w-5 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-black text-gray-900 uppercase tracking-wide",children:"Generation Failed"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"We encountered an error while processing your request. Please try again or adjust your settings."})]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>c("IDLE"),className:"text-red-600 hover:bg-red-100 hover:text-red-700 font-bold uppercase text-[10px] tracking-widest",children:"Dismiss & Retry"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-10",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-10",children:[e.jsxs("section",{className:"bg-white rounded-2xl border border-gray-100 p-8 shadow-2xl shadow-gray-200/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-blue-500/10 flex items-center justify-center text-blue-500",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("h3",{className:"text-xl font-black text-gray-900 uppercase tracking-tighter",children:"Product Image"})]}),e.jsx(Ne,{selectedProducts:te,onProductSelect:ae,onImageUploaded:o})]}),a.mediaType==="IMAGE"?e.jsx(Re,{customPrompt:x,setCustomPrompt:g,style:a.style,setStyle:s=>h({style:s}),mood:a.mood,setMood:s=>h({mood:s}),variations:a.variants,setVariations:s=>h({variants:s})}):e.jsx(Fe,{customPrompt:x,setCustomPrompt:g,scenes:a.scenes,setScenes:s=>h({scenes:s}),duration:a.duration?.toString()||"10",setDuration:s=>h({duration:parseInt(s)}),variations:a.variants,setVariations:s=>h({variants:s}),videoScript:a.videoScript,setVideoScript:P}),a.mediaType==="VIDEO"&&e.jsx(ze,{modelImageUrl:a.modelImageUrl||null,onImageChange:s=>h({modelImageUrl:s}),onFileChange:ie,isUploading:J})]}),e.jsxs("div",{className:"lg:col-span-4 lg:sticky lg:top-8 h-fit space-y-6",children:[e.jsxs("div",{className:"p-6 rounded-2xl bg-gray-900 text-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ke,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-primary",children:"AI Optimization"})]}),e.jsxs("p",{className:"text-xs text-gray-400 mb-6 font-medium leading-relaxed",children:["Your selections are ready for synthesis. Our neural processors will now calibrate for the ",a.dimensions," format."]}),e.jsx("div",{className:"w-full",children:R?e.jsx(j,{type:"button",onClick:se,disabled:E.isPending||G,className:"w-full h-16 rounded-xl shadow-2xl shadow-primary/30 bg-primary group hover:scale-[1.02] active:scale-95 transition-all outline-1 outline-white/80",children:e.jsx("div",{className:"flex flex-col items-center",children:E.isPending||G?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-black text-white uppercase tracking-[0.2em]",children:"Generate Ad"}),e.jsxs("span",{className:"text-[10px] font-bold text-white/70 uppercase tracking-widest mt-0.5",children:["Cost: ",k," ",k===1?"Credit":"Credits"]})]})})}):e.jsx(j,{type:"button",onClick:()=>O(!0),className:"w-full h-16 rounded-xl shadow-2xl shadow-amber-500/30 bg-linear-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 group hover:scale-[1.02] active:scale-95 transition-all",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-white"}),e.jsx("span",{className:"text-sm font-black text-white uppercase tracking-[0.2em]",children:"Upgrade Plan"})]}),e.jsx("span",{className:"text-[10px] font-bold text-white/70 uppercase tracking-widest mt-0.5",children:C?`Need ${k-(N?.creditWallet?.balance??0)} more credit${k-(N?.creditWallet?.balance??0)!==1?"s":""}`:"Subscription required"})]})})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-xl bg-blue-50/50 border border-blue-100",children:[e.jsx(Se,{className:"h-4 w-4 text-blue-500 shrink-0"}),e.jsx("p",{className:"text-[10px] text-blue-600 font-bold leading-normal",children:R?"Credits will only be deducted upon successful synthesis of the final visual assets.":C?"Top up your credits to continue generating ads.":"Subscribe to a plan to unlock AI ad generation."})]})]})]}),e.jsx(Ae,{open:Y,onClose:()=>O(!1),reason:C?"insufficient-credits":"no-subscription",creditDeficit:C?k-(N?.creditWallet?.balance??0):void 0})]})}const qe=({mediaType:t,currentStep:n,onSwitch:i})=>e.jsxs("div",{className:"mb-10 flex flex-col sm:flex-row items-center justify-between gap-6 p-6 bg-white rounded-[2rem] border border-gray-100 shadow-xl shadow-gray-200/20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:w("p-3 rounded-2xl shadow-sm",t==="IMAGE"?"bg-blue-50 text-blue-600":"bg-purple-50 text-purple-600"),children:t==="IMAGE"?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),e.jsx("circle",{cx:"9",cy:"9",r:"2"}),e.jsx("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}),e.jsx("path",{d:"M7 3v18M17 3v18M3 7h4M3 12h4M3 17h4M17 7h4M17 12h4M17 17h4"})]})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-black text-gray-900 uppercase tracking-tighter",children:[e.jsx("span",{className:"text-primary",children:"Generate "}),t==="IMAGE"?"Image":"Video"," Ad"," "]}),e.jsxs("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mt-0.5",children:["AI Generation â€¢ Step ",n," of 3"]})]})]}),e.jsxs("button",{onClick:i,className:"group flex items-center gap-3 px-6 py-3 rounded-full bg-gray-50 hover:bg-gray-900 text-gray-500 hover:text-white transition-all duration-300 border border-gray-100 hover:border-gray-900 shadow-sm",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest",children:["Switch to ",t==="IMAGE"?"Video":"Image"]}),e.jsx("div",{className:"h-5 w-5 rounded-full bg-white text-gray-400 group-hover:text-gray-900 flex items-center justify-center transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M7 4V20L17 12L7 4Z"})})})]})]}),$e=({selectedProducts:t,currentStep:n})=>e.jsx(X,{children:t.length>0&&n<3&&e.jsxs(v.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-8 flex flex-wrap items-center gap-3 p-4 bg-white rounded-2xl border border-primary/10 shadow-sm",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-gray-400 ml-2 mr-2",children:"Working With:"}),t.map(i=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-primary/5 rounded-full border border-primary/10",children:[i.metadata?.imageUrl&&e.jsx("img",{src:i.metadata.imageUrl,alt:"",className:"w-5 h-5 rounded-full object-cover"}),e.jsx("span",{className:"text-[10px] font-bold text-primary uppercase truncate max-w-[120px]",children:i.metadata?.title||"Product Asset"})]},i.id))]})});function Be(){const{selectedCategoryId:t,selectedTemplateId:n,setSelectedTemplate:i,goToNextStep:x,goToPreviousStep:p,options:a}=I(),{data:d,isLoading:m}=Ve(t),l=d?.data||[];console.log("CategoryTemplates: ",d);const o=r=>{i(r),x()};if(m)return e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(M,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm font-black uppercase tracking-widest text-gray-400",children:"Fetching Templates..."})]})});const g={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},h={hidden:{scale:.9,opacity:0},visible:{scale:1,opacity:1}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{variant:"ghost",onClick:p,className:"px-8 h-12 bg-gray-100 rounded-full font-black uppercase tracking-widest text-[10px] text-gray-400 hover:text-primary transition-colors",children:[e.jsx(H,{className:"mr-2 h-3 w-3"}),"Change Category"]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-3xl font-black text-gray-900 uppercase tracking-tighter",children:["Choose ",e.jsx("span",{className:"text-primary",children:"Template"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-2 font-medium max-w-md mx-auto",children:"Choose a structural foundation. Our AI will adapt your product into this layout."})]}),e.jsx("div",{className:"w-auto"})]}),e.jsx(v.div,{variants:g,initial:"hidden",animate:"visible",className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:l.map(r=>{const c=n===r.id,P=r.previewImages?.[0]||r.referenceAdImage;return e.jsxs(v.button,{variants:h,onClick:()=>o(r),className:w("group relative rounded-2xl border-2 transition-all duration-500 overflow-hidden aspect-3/4",c?"border-primary shadow-2xl shadow-primary/20 ring-4 ring-primary/10":"border-gray-50 bg-white hover:border-primary/40"),children:[e.jsx("div",{className:"absolute inset-0 bg-gray-100",children:P?e.jsx("img",{src:P,alt:r.name,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-50",children:e.jsx(Ee,{className:"h-8 w-8 text-gray-200"})})}),e.jsx("div",{className:"absolute inset-0 bg-linear-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 text-left",children:[e.jsx("h3",{className:"text-white font-black text-xs uppercase tracking-tight",children:r.name}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs("div",{className:"text-[9px] font-bold text-white/70 uppercase tracking-widest bg-white/10 px-2 py-0.5 rounded backdrop-blur-sm",children:[r.variableIds?.length||0," VARS"]})})]})}),c&&e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute top-3 right-3 h-6 w-6 rounded-full bg-primary flex items-center justify-center shadow-lg",children:e.jsx(T,{className:"h-3 w-3 text-white"})})]},r.id)})})]})}function Je({mediaType:t}){const{currentStep:n,resetFlow:i,selectedProducts:x}=I(),[p,a]=f.useState(!1);f.useEffect(()=>{a(!0),I.getState().options.mediaType!==t?(console.warn(`ðŸ›¡ï¸  Flow mismatch detected. Hard resetting to ${t}`),i(t)):console.warn(`âœ… Flow verified: ${t}`)},[t,i]);const d=f.useMemo(()=>[{number:1,label:"Category",component:e.jsx(_e,{})},{number:2,label:"Template",component:e.jsx(Be,{})},{number:3,label:"Customize",component:e.jsx(We,{})}],[]),m=()=>{const o=t==="IMAGE"?"VIDEO":"IMAGE";window.confirm(`Switch to ${o==="IMAGE"?"Image":"Video"} generation? This will reset your current progress.`)&&(i(o),window.location.href=`/ads/generate/${o.toLowerCase()}`)};if(!p)return e.jsx(Ue,{fullScreen:!1});const l=d.find(o=>o.number===n)?.component;return e.jsxs("div",{className:"w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(qe,{mediaType:t,currentStep:n,onSwitch:m}),e.jsx($e,{selectedProducts:x,currentStep:n}),e.jsx("div",{className:"bg-white rounded-3xl border border-gray-100 shadow-2xl shadow-gray-200/50 p-6 sm:p-8 lg:p-12 overflow-hidden",children:e.jsx(X,{mode:"wait",children:e.jsx(v.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3,ease:"easeInOut"},children:l},n)})})]})}export{Je as M};
